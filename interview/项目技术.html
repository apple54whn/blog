<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目技术 | Conanan</title>
    <meta name="description" content="apple54whn的文档,conanan的文档">
    <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.2be5de51.css" as="style"><link rel="preload" href="/assets/js/app.d8cb9cb7.js" as="script"><link rel="preload" href="/assets/js/2.3b02efce.js" as="script"><link rel="preload" href="/assets/js/23.6de8e3ef.js" as="script"><link rel="prefetch" href="/assets/js/10.f8026447.js"><link rel="prefetch" href="/assets/js/11.19d3094c.js"><link rel="prefetch" href="/assets/js/12.04fab03d.js"><link rel="prefetch" href="/assets/js/13.96ecc411.js"><link rel="prefetch" href="/assets/js/14.076625fd.js"><link rel="prefetch" href="/assets/js/15.663af154.js"><link rel="prefetch" href="/assets/js/16.8851cfe7.js"><link rel="prefetch" href="/assets/js/17.94a979e8.js"><link rel="prefetch" href="/assets/js/18.923289d1.js"><link rel="prefetch" href="/assets/js/19.95d7a536.js"><link rel="prefetch" href="/assets/js/20.2b3c6974.js"><link rel="prefetch" href="/assets/js/21.661409df.js"><link rel="prefetch" href="/assets/js/22.ca5f0d41.js"><link rel="prefetch" href="/assets/js/24.364196f3.js"><link rel="prefetch" href="/assets/js/3.14089e0c.js"><link rel="prefetch" href="/assets/js/4.0b088ce7.js"><link rel="prefetch" href="/assets/js/5.ecab5bba.js"><link rel="prefetch" href="/assets/js/6.020ec481.js"><link rel="prefetch" href="/assets/js/7.b7b1e947.js"><link rel="prefetch" href="/assets/js/8.d09e1b35.js"><link rel="prefetch" href="/assets/js/9.5ceebd53.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2be5de51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试总结</a></div><div class="nav-item"><a href="/Java/" class="nav-link">Java</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SQL/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/SQL/Oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/SQL/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/SQL/Spring Data JPA/" class="nav-link">Spring Data JPA</a></li></ul></li><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NoSQL/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/NoSQL/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/NoSQL/Elasticsearch/" class="nav-link">Elasticsearch</a></li></ul></li></ul></div></div> <a href="https://github.com/apple54whn/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试总结</a></div><div class="nav-item"><a href="/Java/" class="nav-link">Java</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SQL/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/SQL/Oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/SQL/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/SQL/Spring Data JPA/" class="nav-link">Spring Data JPA</a></li></ul></li><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NoSQL/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/NoSQL/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/NoSQL/Elasticsearch/" class="nav-link">Elasticsearch</a></li></ul></li></ul></div></div> <a href="https://github.com/apple54whn/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/interview/" class="sidebar-link">Java 基础</a></li><li><a href="/interview/集合.html" class="sidebar-link">集合</a></li><li><a href="/interview/多线程.html" class="sidebar-link">多线程</a></li><li><a href="/interview/SQL.html" class="sidebar-link">数据库</a></li><li><a href="/interview/NoSQL.html" class="sidebar-link">NoSQL</a></li><li><a href="/interview/Java Web.html" class="sidebar-link">Java Web</a></li><li><a href="/interview/Spring.html" class="sidebar-link">Spring</a></li><li><a href="/interview/Tools.html" class="sidebar-link">系统、工具</a></li><li><a href="/interview/项目技术.html" class="active sidebar-link">项目技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/项目技术.html#购物车使用了-cookied-和-redis-缓存" class="sidebar-link">购物车使用了 Cookied 和 Redis 缓存</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#dubbo" class="sidebar-link">Dubbo</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#zookeeper" class="sidebar-link">Zookeeper</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/项目技术.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#集群简介" class="sidebar-link">集群简介</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#rabbitmq" class="sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/项目技术.html#为什么使用消息队列？" class="sidebar-link">为什么使用消息队列？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#消息队列有什么优缺点？" class="sidebar-link">消息队列有什么优缺点？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#activemq、rabbitmq、rocketmq、kafka-有什么优缺点？" class="sidebar-link">ActiveMQ、RabbitMQ、RocketMQ、Kafka 有什么优缺点？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何保证消息队列的高可用？" class="sidebar-link">如何保证消息队列的高可用？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何保证消息不被重复消费？如何保证消息消费的幂等性？" class="sidebar-link">如何保证消息不被重复消费？如何保证消息消费的幂等性？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何保证消息的可靠性传输？如何处理消息丢失的问题？" class="sidebar-link">如何保证消息的可靠性传输？如何处理消息丢失的问题？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何保证消息的顺序性？" class="sidebar-link">如何保证消息的顺序性？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？" class="sidebar-link">如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#发布订阅模式" class="sidebar-link">发布订阅模式</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#路由模式" class="sidebar-link">路由模式</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#带通配符的路由模式" class="sidebar-link">带通配符的路由模式</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#为什么使用消息队列？-2" class="sidebar-link">为什么使用消息队列？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#如何保证消息队列的高可用？-2" class="sidebar-link">如何保证消息队列的高可用？</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#rabbitmq如何保证可靠性传输？" class="sidebar-link">RabbitMQ如何保证可靠性传输？</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#springtask-cron表达式" class="sidebar-link">SpringTask-Cron表达式</a></li><li class="sidebar-sub-header"><a href="/interview/项目技术.html#spring-cloud" class="sidebar-link">Spring Cloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/项目技术.html#springcloud如何实现服务注册发现" class="sidebar-link">springcloud如何实现服务注册发现</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目技术"><a href="#项目技术" aria-hidden="true" class="header-anchor">#</a> 项目技术</h1> <h2 id="购物车使用了-cookied-和-redis-缓存"><a href="#购物车使用了-cookied-和-redis-缓存" aria-hidden="true" class="header-anchor">#</a> 购物车使用了 Cookied 和 Redis 缓存</h2> <p>当用户在<strong>未登录</strong>的情况下，将此购物车存入<strong>cookies</strong> , 在用户登陆的情况下，将购物车数据存入<strong>redis</strong>  。如果用户登陆时，cookies 中存在购物车，需要将cookies的购物车<strong>合并</strong>到 redis 中存储。，<strong>降低了数据库的读写次数，提升服务性能</strong>。</p> <ul><li>存储的是：商家ID、商家名称、购物车列表（存储商品明细），采用组合实体类封装</li> <li>传入数据：SKU ID、SKU数量（可能为负数）</li></ul> <blockquote><p><code>access=&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</code> 用于设置<strong>资源可以在不登陆时可以访问</strong>，此配置与 <code>security=&quot;none&quot;</code>的区别在于当用户未登陆时获取登陆人<strong>账号的值为<code>anonymousUser</code></strong> ，而<code>security=&quot;none&quot;</code>的话，无论是否登陆都不能获取登录人账号的值（在获取时就报空指针异常，因为不走SpringSecurity）</p></blockquote> <p>利用Spring Security获取当前登录的用户名，存在如下两种情况：</p> <ol><li><p>未登录</p> <ol><li><p>从Cookie中<strong>提取我的购物车</strong></p></li> <li><p>向Cookie中<strong>添加商品</strong></p> <p>因为有第三方商家，所以需要判断<strong>该商品所属商家的购物车是否在我的购物车中</strong></p> <ul><li><p>不存在则<strong>创建商品所属的商家购物车</strong>，并<strong>添加到的购物车列表中</strong></p></li> <li><p>存在则需要<strong>判断</strong>当前<strong>商品</strong>是否存在于商家购物车</p> <ul><li><p>不存在则<strong>创建商品</strong>明细并<strong>添加至该商家购物车</strong>中</p></li> <li><p>存在则修改商品数量即可</p> <p>数量为0时则删除该商品；购物车列表长度小于等于0时删除该商家购物车</p></li></ul></li></ul></li> <li><p>最终将我的购物车<strong>存入Cookie</strong></p></li></ol></li> <li><p>已登录</p> <ol><li>从Redis中<strong>提取我的购物车</strong>，根据登陆名称存放的</li> <li>查询<strong>Cookie中是否存在</strong>我的购物车（size&gt;0），存在则<strong>合并我的购物车</strong>（遍历，并调用上面1.2中方法）</li> <li>向购物车<strong>添加商品</strong>（还是上面1.2中方法）</li> <li>最终将我的购物车<strong>存入Redis</strong></li></ol></li></ol> <h2 id="dubbo"><a href="#dubbo" aria-hidden="true" class="header-anchor">#</a> Dubbo</h2> <p>dubbo 在我们项目中主要用来实现<strong>不同系统之间的服务调用</strong>，由于我们项目是<strong>按照不同的功能分了不同的系统</strong>，按照三层架构又<strong>分了不同的服务</strong>，其中三层架构中的<strong>控制层作为服务的消费方</strong>，<strong>业务层和持久层共同作为服务的发布方</strong>，这样的架构实现了<strong>系统的服务化，提高了开发效率，实现了业务的解耦</strong>。</p> <p>我们主要在服务的暴露方通过<code>&lt;dubbo:service&gt;</code>标签来暴露服务，在服务的消费方通过<code>&lt;dubbo:reference&gt;</code>标签来引用服务，注册中心我们选用的是 zookeeper，对服务的URL 进行了管理和配置。</p> <ul><li>Dubbo 是阿里开源的 <strong>RPC（远程过程调用） 的分布式框架</strong>，提供了 SOA 服务治理方案。有5个分为是Provider（服务
的提供方）、Consumer（服务的消费方）、Container（容器）、Registry（注册中心）、Monitor（监控中心）</li> <li><strong>注册中心</strong>：只负责<strong>发现和注册服务</strong>。不参与数据传输，不转发请求，压力较小
<ul><li>注册中心宕机问题
<ul><li>注册中心会集群部署，其中一台宕机，自动切换到另一台。</li> <li>全部宕机后还可以通过本地缓存通信</li></ul></li></ul></li> <li><strong>监控中心</strong>：负责统计各<strong>服务调用次数、调用时间</strong>等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示</li></ul> <p>在使用Duubo 的过程中你们遇到过什么问题？</p> <ul><li><p>序列化和反序列化异常</p> <p>调用服务，出现消息发送失败的时候，通常是接口方法的<strong>传入传出参数是新增加的扩展类</strong>，<strong>没有实现序列化接口</strong></p></li> <li><p>怎么禁止一个服务？</p> <p><strong>通过监控中心</strong>的可视化界面，我们可以对具体的服务设置禁止，也可以设置对应的权重</p></li></ul> <h2 id="zookeeper"><a href="#zookeeper" aria-hidden="true" class="header-anchor">#</a> Zookeeper</h2> <h3 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h3> <p>我们项目中主要用 zookeeper 作为 Dubbo 的<strong>注册中心</strong>，集中<strong>管理所有服务的 URL</strong>；同时集中的管理集群的配置。</p> <p>为什么要用zookeeper 作为dubbo 的注册中心？</p> <p>zookeeper 的<strong>数据全部存储在内存中</strong>，性能高；其次， zookeeper 也<strong>支持集群</strong>，实现了高可用；同时基于 zookeeper 的特性，也支持<strong>事件监听</strong>（服务的暴露方发生变化，可以进行推送），所以zookeeper 适合作为 dubbo 的注册中心区使用。</p> <h3 id="集群简介"><a href="#集群简介" aria-hidden="true" class="header-anchor">#</a> 集群简介</h3> <p>为什么搭建Zookeeper集群？</p> <ul><li>大部分分布式应用需要一个主控、协调器或者控制器来管理物理分布的子进程。目前，大多数都要开发私有的协调程序，缺乏一个通用机制，协调程序的反复编写浪费，且难以形成通用、伸缩性好的协调器，zookeeper提供通用的分布式锁服务，用以协调分布式应用。所以说zookeeper是分布式应用的协作服务。</li> <li>zookeeper<strong>作为注册中心，服务器和客户端都要访问，如果有大量的并发肯定会有等待。所以可通过zookeeper集群解决。</strong></li></ul> <hr> <p><strong>Leader选举</strong></p> <p>Zookeeper的启动过程中leader选举是非常重要而且最复杂的一个环节。那么什么是leader选举呢？zookeeper为什么需要leader选举呢？zookeeper的leader选举的过程又是什么样子的？</p> <p>首先我们来看看什么是leader选举。其实这个很好理解，leader选举就像总统选举一样，每人一票，获得多数票的人就当选为总统了。在zookeeper集群中也是一样，每个节点都会投票，如果某个节点获得<strong>超过半数以上的节点的投票</strong>，则该节点就是leader节点了。</p> <blockquote><p>以一个简单的例子来说明整个选举的过程：
假设有**五台服务器组成的zookeeper集群,**它们的id从1-5,同时它们都是最新启动的,也就是没有历史数据,在存放数据量这一点上,都是一样的.假设这些服务器依序启动,来看看会发生什么 。</p> <ol><li>服务器1启动,此时只有它一台服务器启动了,它发出去的报没有任何响应,所以它的选举状态一直是LOOKING状态</li> <li>服务器2启动,它与最开始启动的服务器1进行通信,互相交换自己的选举结果,由于两者都没有历史数据,所以id值较大的服务器2胜出,但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是3),所以服务器1,2还是继续保持LOOKING状态.</li> <li>服务器<strong>3</strong>启动,根据前面的理论分析,服务器3成为服务器1,2,3中的老大,而与上面不同的是,此时有三台服务器选举了它,所以它成为了这次选举的<strong>leader</strong>.</li> <li>服务器4启动,根据前面的分析,理论上服务器4应该是服务器1,2,3,4中最大的,但是由于前面已经有半数以上的服务器选举了服务器3,所以它只能接收当小弟的命了.</li> <li>服务器5启动,同4一样,当小弟</li></ol></blockquote> <h2 id="rabbitmq"><a href="#rabbitmq" aria-hidden="true" class="header-anchor">#</a> RabbitMQ</h2> <h3 id="为什么使用消息队列？"><a href="#为什么使用消息队列？" aria-hidden="true" class="header-anchor">#</a> 为什么使用消息队列？</h3> <p>我们CMS服务有个发布接口，发布成功后需要将生成的静态HTML文件下载到其对应的服务器。可以使用MQ来实现解耦和异步</p> <h3 id="消息队列有什么优缺点？"><a href="#消息队列有什么优缺点？" aria-hidden="true" class="header-anchor">#</a> 消息队列有什么优缺点？</h3> <ul><li>优点：解耦、异步、削峰</li> <li>缺点：<strong>系统复杂度提高</strong>、<strong>可用性</strong>降低，会有<strong>一致性</strong>问题</li></ul> <h3 id="activemq、rabbitmq、rocketmq、kafka-有什么优缺点？"><a href="#activemq、rabbitmq、rocketmq、kafka-有什么优缺点？" aria-hidden="true" class="header-anchor">#</a> ActiveMQ、RabbitMQ、RocketMQ、Kafka 有什么优缺点？</h3> <ul><li>ActiveMQ：社区不活跃</li> <li>RabbitMQ：时效性为微秒级，基于erlang开发，并发性好</li> <li>RocketMQ：阿里开源，捐赠给Apache，功能完善，分布式。可以消息0丢失</li> <li>Kafka：用于大数据领域</li></ul> <h3 id="如何保证消息队列的高可用？"><a href="#如何保证消息队列的高可用？" aria-hidden="true" class="header-anchor">#</a> 如何保证消息队列的高可用？</h3> <p>采用镜像集群模式。创建的 queue，无论元数据还是 queue 里的消息都会<strong>存在于多个实例上</strong>，每次你写消息到 queue 的时候，都会自动把<strong>消息同步</strong>到多个实例的 queue 上。</p> <h3 id="如何保证消息不被重复消费？如何保证消息消费的幂等性？"><a href="#如何保证消息不被重复消费？如何保证消息消费的幂等性？" aria-hidden="true" class="header-anchor">#</a> 如何保证消息不被重复消费？如何保证消息消费的幂等性？</h3> <p>保证<strong>被消费的数据在数据库中只有一条记录！</strong></p> <ul><li>每次写数据库时根据主键之类<strong>查询</strong>，有就不保存了</li> <li>Redis每次都是set，天然幂等</li> <li>若是用类似<strong>分布式id等全局id，消费前查询一下</strong>，保证别重复消费即可。或用<strong>唯一约束</strong>来制约</li></ul> <h3 id="如何保证消息的可靠性传输？如何处理消息丢失的问题？"><a href="#如何保证消息的可靠性传输？如何处理消息丢失的问题？" aria-hidden="true" class="header-anchor">#</a> 如何保证消息的可靠性传输？如何处理消息丢失的问题？</h3> <blockquote><p>不用RabbitMQ的事务机制，同步会吞吐量下降，损耗性能</p></blockquote> <ul><li><p>MQ开启<strong>持久化</strong>，持久化交换机/队列/消息</p></li> <li><p>生产者开启<strong>confirm模式</strong>（分配id），发送到MQ并持久化则返回成功，否则返回失败，此时可以重试。定时重试</p></li> <li><p>消费者关闭<strong>自动ACK机制</strong>，在处理完业务后才ACK，否则MQ会把消息交给其他消费者处理</p></li></ul> <h3 id="如何保证消息的顺序性？"><a href="#如何保证消息的顺序性？" aria-hidden="true" class="header-anchor">#</a> 如何保证消息的顺序性？</h3> <p>拆分多个 queue，每个 queue 一个 consumer，就是多一些 queue 而已，确实是麻烦点。</p> <h3 id="如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？"><a href="#如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？" aria-hidden="true" class="header-anchor">#</a> 如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？</h3> <blockquote><p>消费端每次消费之后要写 mysql，结果 mysql 挂了，消费端 hang 那儿了，不动了；或者是消费端出了个什么岔子，导致消费速度极其慢。</p></blockquote> <ul><li>扩容</li> <li>过期消失：将过期消息查询出来，并传入MQ</li> <li></li></ul> <h3 id="发布订阅模式"><a href="#发布订阅模式" aria-hidden="true" class="header-anchor">#</a> 发布订阅模式</h3> <p>1、每个消费者监听自己的队列。</p> <p>2、生产者将消息发给broker，由<strong>交换机将消息转发到绑定此交换机的每个队列</strong>，每个绑定交换机的队列都将接收到消息</p> <p>==案例：<strong>用户通知</strong>，当用户充值成功或转账完成系统通知用户，通知方式有<strong>短信、邮件</strong>多种方法 。==</p> <h3 id="路由模式"><a href="#路由模式" aria-hidden="true" class="header-anchor">#</a> 路由模式</h3> <p>1、每个消费者监听自己的队列，并且设置routingkey。</p> <p>2、生产者将消息发给交换机，由<strong>交换机根据routingkey来转发消息到指定的队列</strong>。</p> <h3 id="带通配符的路由模式"><a href="#带通配符的路由模式" aria-hidden="true" class="header-anchor">#</a> 带通配符的路由模式</h3> <p>==<strong>根据用户的通知设置去通知用户</strong>，设置接收Email的用户只接收Email，设置接收sms的用户只接收sms，设置两种通知类型都接收的则两种通知都有效。==</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//绑定email通知队列</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>QUEUE_INFORM_EMAIL<span class="token punctuation">,</span>EXCHANGE_TOPICS_INFORM<span class="token punctuation">,</span><span class="token string">&quot;inform.#.email.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绑定sms通知队列</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>QUEUE_INFORM_SMS<span class="token punctuation">,</span>EXCHANGE_TOPICS_INFORM<span class="token punctuation">,</span><span class="token string">&quot;inform.#.sms.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="为什么使用消息队列？-2"><a href="#为什么使用消息队列？-2" aria-hidden="true" class="header-anchor">#</a> 为什么使用消息队列？</h3> <ul><li>解耦：其他系统都要这个数据，只需要订阅这个队列即可，不和本系统直接打交道</li> <li>异步：对于写操作来说，不需要获取结果，可以采用异步方式</li> <li>削峰：存放在MQ中，慢慢消费，无论有多少请求进入MQ</li></ul> <h3 id="如何保证消息队列的高可用？-2"><a href="#如何保证消息队列的高可用？-2" aria-hidden="true" class="header-anchor">#</a> 如何保证消息队列的高可用？</h3> <p><strong>镜像集群模式</strong>：创建的 queue，无论元数据还是 queue 里的消息都会<strong>存在于多个实例上</strong>，每次你写消息到 queue 的时候，都会自动把<strong>消息同步</strong>到多个实例的 queue 上。</p> <h3 id="rabbitmq如何保证可靠性传输？"><a href="#rabbitmq如何保证可靠性传输？" aria-hidden="true" class="header-anchor">#</a> RabbitMQ如何保证可靠性传输？</h3> <p>持久化：持久化交换机、队列、消息</p> <p>ACK确认机制：</p> <ul><li>消息发送确认：
<ul><li><strong>ConfirmCallback消息正确到达 Exchange 中时回调</strong>（有个消息唯一标示来确定哪条消息）</li> <li><strong>ReturnCallback消息没有正确到达QUEUE时</strong>触发回调，如果正确到达队列不执行</li></ul></li> <li>手动消息接收确认（根据是否包含error来确认或拒绝）</li></ul> <p>消息发送、消息接收时<strong>记录日志，定时轮询</strong>，没发送的继续发送。</p> <h2 id="springtask-cron表达式"><a href="#springtask-cron表达式" aria-hidden="true" class="header-anchor">#</a> SpringTask-Cron表达式</h2> <p>Seconds Minutes Hours DayofMonth Month DayofWeek Year（只能省略最后一位，且俩最长的不能同时出现，其中一个必为?）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0 * * * * ?&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>0 0 10,14,16 * * ? 每天上午10点，下午2点，4点
0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时
0 0 12 ? * WED 表示每个星期三中午12点
&quot;0 0 12 * * ?&quot; 每天中午12点触发
&quot;0 15 10 ? * *&quot; 每天上午10:15触发
&quot;0 15 10 * * ?&quot; 每天上午10:15触发
&quot;0 15 10 * * ? *&quot; 每天上午10:15触发
&quot;0 15 10 * * ? 2005&quot; 2005年的每天上午10:15触发
&quot;0 * 14 * * ?&quot; 在每天下午2点到下午2:59期间的每1分钟触发
&quot;0 0/5 14 * * ?&quot; 在每天下午2点到下午2:55期间的每5分钟触发
&quot;0 0/5 14,18 * * ?&quot; 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发
&quot;0 0-5 14 * * ?&quot; 在每天下午2点到下午2:05期间的每1分钟触发
&quot;0 10,44 14 ? 3 WED&quot; 每年三月的星期三的下午2:10和2:44触发
&quot;0 15 10 ? * MON-FRI&quot; 周一至周五的上午10:15触发
&quot;0 15 10 15 * ?&quot; 每月15日上午10:15触发
&quot;0 15 10 L * ?&quot; 每月最后一日的上午10:15触发
&quot;0 15 10 ? * 6L&quot; 每月的最后一个星期五上午10:15触发
&quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月的最后一个星期五上午10:15触发
&quot;0 15 10 ? * 6#3&quot; 每月的第三个星期五上午10:15触发</p> <h2 id="spring-cloud"><a href="#spring-cloud" aria-hidden="true" class="header-anchor">#</a> Spring Cloud</h2> <h3 id="springcloud如何实现服务注册发现"><a href="#springcloud如何实现服务注册发现" aria-hidden="true" class="header-anchor">#</a> springcloud如何实现服务注册发现</h3> <p>服务在发布时 指定对应的服务名（服务名包括了IP地址和端口） 将服务注册到注册中心（eureka或者zookeeper），@EnableDisscoveryClient会被带@EnableEurekaServer的Eureka服务发现并注册。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/apple54whn/docs/edit/master/docs/interview/项目技术.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间: </span> <span class="time">2019-7-6 6:18:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/interview/Tools.html" class="prev">
          系统、工具
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d8cb9cb7.js" defer></script><script src="/assets/js/2.3b02efce.js" defer></script><script src="/assets/js/23.6de8e3ef.js" defer></script>
  </body>
</html>
