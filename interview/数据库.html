<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库 | Conanan</title>
    <meta name="description" content="apple54whn的文档,conanan的文档">
    <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.2be5de51.css" as="style"><link rel="preload" href="/assets/js/app.d8cb9cb7.js" as="script"><link rel="preload" href="/assets/js/2.3b02efce.js" as="script"><link rel="preload" href="/assets/js/21.661409df.js" as="script"><link rel="prefetch" href="/assets/js/10.f8026447.js"><link rel="prefetch" href="/assets/js/11.19d3094c.js"><link rel="prefetch" href="/assets/js/12.04fab03d.js"><link rel="prefetch" href="/assets/js/13.96ecc411.js"><link rel="prefetch" href="/assets/js/14.076625fd.js"><link rel="prefetch" href="/assets/js/15.663af154.js"><link rel="prefetch" href="/assets/js/16.8851cfe7.js"><link rel="prefetch" href="/assets/js/17.94a979e8.js"><link rel="prefetch" href="/assets/js/18.923289d1.js"><link rel="prefetch" href="/assets/js/19.95d7a536.js"><link rel="prefetch" href="/assets/js/20.2b3c6974.js"><link rel="prefetch" href="/assets/js/22.ca5f0d41.js"><link rel="prefetch" href="/assets/js/23.6de8e3ef.js"><link rel="prefetch" href="/assets/js/24.364196f3.js"><link rel="prefetch" href="/assets/js/3.14089e0c.js"><link rel="prefetch" href="/assets/js/4.0b088ce7.js"><link rel="prefetch" href="/assets/js/5.ecab5bba.js"><link rel="prefetch" href="/assets/js/6.020ec481.js"><link rel="prefetch" href="/assets/js/7.b7b1e947.js"><link rel="prefetch" href="/assets/js/8.d09e1b35.js"><link rel="prefetch" href="/assets/js/9.5ceebd53.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2be5de51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试总结</a></div><div class="nav-item"><a href="/Java/" class="nav-link">Java</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SQL/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/SQL/Oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/SQL/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/SQL/Spring Data JPA/" class="nav-link">Spring Data JPA</a></li></ul></li><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NoSQL/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/NoSQL/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/NoSQL/Elasticsearch/" class="nav-link">Elasticsearch</a></li></ul></li></ul></div></div> <a href="https://github.com/apple54whn/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试总结</a></div><div class="nav-item"><a href="/Java/" class="nav-link">Java</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SQL/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/SQL/Oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/SQL/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/SQL/Spring Data JPA/" class="nav-link">Spring Data JPA</a></li></ul></li><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NoSQL/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/NoSQL/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/NoSQL/Elasticsearch/" class="nav-link">Elasticsearch</a></li></ul></li></ul></div></div> <a href="https://github.com/apple54whn/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/interview/" class="sidebar-link">Java 基础</a></li><li><a href="/interview/集合.html" class="sidebar-link">集合</a></li><li><a href="/interview/多线程.html" class="sidebar-link">多线程</a></li><li><a href="/interview/SQL.html" class="sidebar-link">数据库</a></li><li><a href="/interview/NoSQL.html" class="sidebar-link">NoSQL</a></li><li><a href="/interview/Java Web.html" class="sidebar-link">Java Web</a></li><li><a href="/interview/Spring.html" class="sidebar-link">Spring</a></li><li><a href="/interview/Tools.html" class="sidebar-link">系统、工具</a></li><li><a href="/interview/项目技术.html" class="sidebar-link">项目技术</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据库"><a href="#数据库" aria-hidden="true" class="header-anchor">#</a> 数据库</h1> <h2 id="delete-与-truncate-删除表记录区别"><a href="#delete-与-truncate-删除表记录区别" aria-hidden="true" class="header-anchor">#</a> DELETE 与 TRUNCATE 删除表记录区别</h2> <ul><li>DELETE每次从表中删除一行，并将该操作作为事务记录在<strong>日志</strong>中以便回滚，<strong>不清空 AUTO_INCREMENT 记录</strong>数</li> <li>TRUNCATE<strong>直接删除</strong>表并<strong>重新创建</strong>新表，不能回滚， <strong>AUTO_INCREMENT置为0</strong>，<strong>效率比DELETE高</strong></li></ul> <h2 id="存储过程"><a href="#存储过程" aria-hidden="true" class="header-anchor">#</a> 存储过程</h2> <p>一组为了完成特定功能的 SQL 语句集，，经编译后存储在数据库中，可以通过存储过程名称调用</p> <h2 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h2> <p>对数据库中一或多个列值的排序，帮助数据库高效获取数据的数据结构。有：普通索引、唯一索引、主键索引、全文索引</p> <ul><li>优点：
<ul><li><strong>加快检索速度</strong></li> <li>唯一索引确保每行数据的唯一性</li> <li>在使用索引的过程可以优化隐藏器，提高系统性能</li></ul></li> <li>缺点：<strong>插入、删除、修改</strong>、维护速度下降，且<strong>占</strong>用物理和数据<strong>空间</strong></li></ul> <h2 id="事务四大特性（acid）"><a href="#事务四大特性（acid）" aria-hidden="true" class="header-anchor">#</a> 事务四大特性（ACID）</h2> <ul><li><strong>原子性</strong>（Atomicity）：事务中所有操作是不可再分割的<strong>原子单位</strong>。事务中所有操作要么全部执行成功，要么全部执行失败。</li> <li><strong>一致性</strong>（Consistency）：在事务开始之前和事务结束以后，数据库<strong>状态保持一致</strong>。如转账业务，无论事务执行成功与否，参与转账的两个账号余额之和应该是不变的。</li> <li><strong>隔离性</strong>（Isolation）：隔离性是指在<strong>并发</strong>操作中，<strong>不同事务之间应该隔离</strong>开来，使每个并发中的事务不会相互干扰。</li> <li><strong>持久性</strong>（Durability）：一旦事务<strong>提交</strong>成功，它<strong>对数据的改变必须是永久</strong>的，即使出现系统故障。</li></ul> <h2 id="并发事务问题与隔离级别"><a href="#并发事务问题与隔离级别" aria-hidden="true" class="header-anchor">#</a> 并发事务问题与隔离级别</h2> <p>问题：</p> <ul><li>脏读：一个事务读取到另一个事务<strong>未提交</strong>的数据</li> <li>不可重复读：一个事务中<strong>两次读取的数据内容</strong>不一致。这是事务update 时引发的问题。</li> <li>幻读：一个事务中<strong>两次读取的数据的数量不一致</strong>，这是 insert 或 delete 时引发的问题。</li></ul> <p><strong>四大隔离级别</strong>（“×”表示会出现这种问题；“ ”表示不会出现这种问题）</p> <table><thead><tr><th style="text-align:center;">级别</th> <th style="text-align:center;">名称</th> <th style="text-align:center;">隔离级别</th> <th style="text-align:center;">脏读</th> <th style="text-align:center;">不可重复读</th> <th style="text-align:center;">幻读</th> <th style="text-align:center;">数据库默认隔离级别</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">读未提交</td> <td style="text-align:center;">read uncommitted</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">读已提交</td> <td style="text-align:center;">read committed</td> <td style="text-align:center;"></td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">Oracle 和 SQL Server</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">可重复读</td> <td style="text-align:center;">repeatable read</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">×</td> <td style="text-align:center;">MySQL</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">串行化</td> <td style="text-align:center;">serializable</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr></tbody></table> <blockquote><p>上面的级别最低，下面的级别最高。隔离级别越高，性能越差，安全性越高。</p></blockquote> <h2 id="如何进行事务管理"><a href="#如何进行事务管理" aria-hidden="true" class="header-anchor">#</a> 如何进行事务管理</h2> <p><strong>Connection</strong>的三个方法与事务相关：</p> <ul><li><strong>setAutoCommit</strong>(boolean)：设置是否为自动提交事务，如果true（默认值就是true）表示自动提交，也就是每条执行的SQL语句都是一个单独的事务，如果设置<strong>false</strong>，那么就相当于开启了事务了；</li> <li><strong>commit</strong>()：提交事务</li> <li><strong>rollback</strong>()：回滚事务</li></ul> <p>还可以设置Savepoint，允许通过代码设置保存点并让事务回滚到指定的保存点</p> <h2 id="sql-优化"><a href="#sql-优化" aria-hidden="true" class="header-anchor">#</a> SQL 优化</h2> <ul><li><p>查询结果<strong>不要用</strong><em>来查询所有字段，要明确</em><em>指明结果字段</em>*</p></li> <li><p>对查询进行优化，避免全表扫描，首先应考虑在 <strong>where 及 order by 涉及的列上建立索引</strong>，建立<strong>索引时字段不能有 null 值</strong></p></li> <li><p><strong>索引不是越多越好</strong>。在提高select效率同时，降低了<strong>insert和update</strong>效率（可能会重建索引）。一个表索引数最好不要超过6个</p></li> <li><p>根据查询条件，建立索引，如果<strong>查询条件不止一个</strong>时，使用<strong>组合索引</strong></p></li> <li><p><strong>避免在 where 子句中对字段进行 null 值判断、使用!=或&lt;&gt;操作符、使用 or 来连接条件、in 和 not in 也要慎用</strong>，否则将导致引擎放弃使用索引而进行全表扫描</p> <p>在查询<strong>条件表达式的左侧尽量不要使用函数</strong>，否则索引失效</p> <p>如果有 <strong>like</strong> 话，尽量避免%xxx%两侧都有%的条件，<strong>单侧%可以使用索引</strong>，多侧不可以</p></li></ul> <h2 id="mysql-数据库优化"><a href="#mysql-数据库优化" aria-hidden="true" class="header-anchor">#</a> MySQL 数据库优化</h2> <ul><li><strong>EXPLAIN</strong> 你的 SELECT 查询</li> <li>当只要<strong>一行数据</strong>时使用 <strong>LIMIT 1</strong></li> <li>使用 <strong>ENUM</strong> 而<strong>不是 VARCHAR</strong></li> <li><strong>固定长度的表</strong>会更<strong>快</strong></li></ul> <h2 id="常用工具"><a href="#常用工具" aria-hidden="true" class="header-anchor">#</a> 常用工具</h2> <h3 id="慢查询日志"><a href="#慢查询日志" aria-hidden="true" class="header-anchor">#</a> 慢查询日志</h3> <h3 id="explain-执行计划"><a href="#explain-执行计划" aria-hidden="true" class="header-anchor">#</a> Explain 执行计划</h3> <h3 id="profiling"><a href="#profiling" aria-hidden="true" class="header-anchor">#</a> Profiling</h3> <h3 id="数据库连接进程表"><a href="#数据库连接进程表" aria-hidden="true" class="header-anchor">#</a> 数据库连接进程表</h3> <h2 id="引擎"><a href="#引擎" aria-hidden="true" class="header-anchor">#</a> 引擎</h2> <h3 id="innodb"><a href="#innodb" aria-hidden="true" class="header-anchor">#</a> InnoDB</h3> <h3 id="myisam"><a href="#myisam" aria-hidden="true" class="header-anchor">#</a> MyIsam</h3> <h3 id="blackhole"><a href="#blackhole" aria-hidden="true" class="header-anchor">#</a> Blackhole</h3> <h2 id="主从复制master-salve"><a href="#主从复制master-salve" aria-hidden="true" class="header-anchor">#</a> 主从复制Master/Salve</h2> <h2 id="读写分离"><a href="#读写分离" aria-hidden="true" class="header-anchor">#</a> 读写分离</h2> <h2 id="mybatis-中一级和二级缓存的区别？"><a href="#mybatis-中一级和二级缓存的区别？" aria-hidden="true" class="header-anchor">#</a> MyBatis 中一级和二级缓存的区别？</h2> <p>一级缓存是 SqlSession 级别的缓存。在操作数据库时需要构造 sqlSession 对象，在对象中有一个(内存区域)数据结构（HashMap）用于存储缓存数据。不同的 sqlSession之间的缓存数据区域（HashMap）是互相不影响的。
一级缓存的作用域是同一个 SqlSession，在同一个 sqlSession中两次执行相同的 sql语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession结束后该 sqlSession中的一级缓存也就不存在了。Mybatis默认开启一级缓存。
二级缓存是 mapper级别的缓存，多个 SqlSession去操作同一个 Mapper的sql语句，多个 SqlSession去操作数据库得到数据会存在二级缓存区域，多个 SqlSession可以共用二级缓存，二级缓存是跨 SqlSession的。
二级缓存是多个 SqlSession 共享的，其作用域是 mapper 的同一个 namespace，不同的sqlSession两次执行相同 namespace下的 sql语句且向 sql中传递参数也相同即最终执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存需要在setting全局参数中配置开启二级缓存。</p> <h2 id="什么是redis？用处？"><a href="#什么是redis？用处？" aria-hidden="true" class="header-anchor">#</a> 什么是Redis？用处？</h2> <p>Redis是一个<strong>开源的高性能key-value数据库</strong>。应用场景如下：</p> <ul><li><p><strong>缓存</strong>（数据查询、短连接、新闻内容、商品内容等等）</p></li> <li><p><strong>队列</strong>（秒杀、抢购、12306等等）</p></li> <li><p>发布/订阅</p></li> <li><p>排行榜/计数器</p></li></ul> <h2 id="redis相比-memcached-有哪些优势？"><a href="#redis相比-memcached-有哪些优势？" aria-hidden="true" class="header-anchor">#</a> Redis相比 memcached 有哪些优势？</h2> <ul><li>Redis<strong>速度</strong>比memcached快很多</li> <li>Redis支持丰富的<strong>数据类型</strong>，memcached所有值都是简单的字符串类型</li> <li>Redis可以<strong>持久化</strong>数据</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/apple54whn/docs/edit/master/docs/interview/数据库.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间: </span> <span class="time">2019-4-1 10:36:38 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d8cb9cb7.js" defer></script><script src="/assets/js/2.3b02efce.js" defer></script><script src="/assets/js/21.661409df.js" defer></script>
  </body>
</html>
